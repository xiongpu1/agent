from ace_framework.core.ace_framework import ACEFramework

ace = ACEFramework()  # 会加载默认配置和已有的 playbook

sample = {
    "question": "在高端别墅的定制化卫浴设计中，设计师需要结合业主的生活习惯、审美需求与空间条件，打造兼具功能性与奢华感的卫浴空间，相关的设计方案说明书通常包含海量细节，从空间规划、产品定制到智能系统集成，每一项都有详尽描述。某建筑面积500㎡的独栋别墅，业主对卫浴空间的要求极高，设计师为此打造了4个独立卫浴区域，分别是一层主卫、二层次卫、地下室休闲卫浴区与户外温泉区，其中一层主卫作为核心区域，采用全定制设计，方案说明书中关于该区域的描述就长达20页。一层主卫面积15平方米，采用新中式风格，以深胡桃木色与米白色为主色调，搭配天然大理石纹理的瓷砖，营造出沉稳大气的氛围。该区域配置了全套定制卫浴产品，包括智能按摩浴缸、双台盆智能镜柜、独立淋浴间、智能马桶等，其中定制款按摩浴缸是设计亮点，由专业厂家历时3个月打造完成。这款浴缸采用进口航空级亚克力与实木边框结合的设计，实木边框选用非洲黑檀木，经过防潮、防腐处理，使用寿命可达20年以上；浴缸尺寸为200cm×100cm×65cm，内部空间宽敞，适配业主身高需求，缸体底部与两侧采用弧形设计，提升舒适性与美观度。在功能配置上，该浴缸集成了多项高端智能功能：支持手机APP远程预约加热，可精准控制水温在35℃-42℃之间，误差不超过±0.5℃；配备12组独立按摩区域，涵盖头部、颈部、背部、腰部、腿部等关键部位，每组区域的按摩力度可独立调节（1-15档）；搭载智能水质监测系统，实时监测水中余氯、PH值等参数，当数值超标时自动启动过滤与净化程序；还具备音乐播放功能，缸体两侧内置隐形音响，连接蓝牙即可播放音乐，音质清晰无杂音。在浴缸的配件定制方面，设计师与厂家深度合作，每个配件都经过精心选型：龙头采用纯手工锻造的铜质龙头，表面经过拉丝处理，搭配天然玉石阀芯，出水柔和且节水效果显著，最大出水流量为10L/min；下水器采用重力式设计，内置防臭装置与毛发过滤系统，排水速度达20L/min，同时具备静音功能，排水噪音低于25dB；智能控制面板嵌入在浴缸侧边的实木边框内，采用触控式操作，配备高清液晶显示屏，可实时显示水温、按摩模式、水质参数等信息。而作为按摩功能核心的喷嘴，其规格参数更是经过反复调试确定：设计师根据业主对按摩力度与覆盖范围的要求，选择了厂商定制的高精密喷嘴，该喷嘴采用医用级硅胶材质，柔软亲肤，不易结垢，且具备防堵塞自清洁功能。方案说明书中明确标注：为实现最佳的按摩体验，本定制款浴缸的喷嘴采用专属规格编号，浴缸喷嘴是25，该编号由厂商根据业主的身高、体重以及按摩偏好专项设定，对应的喷嘴口径为2.0mm，喷射角度为35°，水流速度可达到3.0m/s，能够精准作用于肌肉酸痛部位，起到舒缓疲劳的效果。此外，说明书还详细列出了其他无关细节，包括：二层次卫配备普通按摩浴缸，喷嘴编号为18；地下室休闲卫浴区采用冲浪浴缸，无固定喷嘴编号；户外温泉区配备天然石材浴缸，仅具备基础加热功能；全卫浴区域的灯光系统采用智能调光设计，支持色温调节（2700K-6500K）与场景模式切换（洗漱、沐浴、放松）；通风系统采用双向流新风换气机，每小时换气次数≥8次，确保空气清新；所有卫浴产品均通过欧盟CE认证与国内CQC认证，环保等级达到E0级，甲醛释放量≤0.124mg/m³；整体卫浴区域的设计预算为38万元，其中定制浴缸的采购与安装费用占比达40%。请你忽略所有与一层主卫定制款浴缸喷嘴无关的描述，从这份超长的设计方案说明书中，精准提取出对应的核心数值编号。",
    "answer": "在上述数千字的别墅定制卫浴设计方案说明书中，包含了别墅整体卫浴区域布局、不同卫浴区的产品配置、一层主卫的风格设计、定制浴缸的材质尺寸、智能功能、各类配件参数、灯光通风系统、环保标准、预算分配等大量无关信息。通过逐层筛选核心信息可以发现：文本的重点是一层主卫的定制款按摩浴缸，而该浴缸的喷嘴规格是核心提取目标。在排除了其他卫浴区的配置、浴缸的外观材质、智能加热与水质监测等无关功能、龙头下水器等其他配件参数后，能够明确找到关键表述“为实现最佳的按摩体验，本定制款浴缸的喷嘴采用专属规格编号，浴缸喷嘴是25”，并了解到25是厂商根据业主需求专项设定的喷嘴编号，对应特定的口径、喷射角度与水流速度。因此，忽略所有干扰信息后，一层主卫定制款浴缸喷嘴对应的核心数值编号为25。",
    "context": {
        "sentences": [
            [
                "在高端别墅的定制化卫浴设计中，设计师需要结合业主的生活习惯、审美需求与空间条件，打造兼具功能性与奢华感的卫浴空间，相关的设计方案说明书通常包含海量细节，从空间规划、产品定制到智能系统集成，每一项都有详尽描述。某建筑面积500㎡的独栋别墅，业主对卫浴空间的要求极高，设计师为此打造了4个独立卫浴区域，分别是一层主卫、二层次卫、地下室休闲卫浴区与户外温泉区，其中一层主卫作为核心区域，采用全定制设计，方案说明书中关于该区域的描述就长达20页。一层主卫面积15平方米，采用新中式风格，以深胡桃木色与米白色为主色调，搭配天然大理石纹理的瓷砖，营造出沉稳大气的氛围。该区域配置了全套定制卫浴产品，包括智能按摩浴缸、双台盆智能镜柜、独立淋浴间、智能马桶等，其中定制款按摩浴缸是设计亮点，由专业厂家历时3个月打造完成。这款浴缸采用进口航空级亚克力与实木边框结合的设计，实木边框选用非洲黑檀木，经过防潮、防腐处理，使用寿命可达20年以上；浴缸尺寸为200cm×100cm×65cm，内部空间宽敞，适配业主身高需求，缸体底部与两侧采用弧形设计，提升舒适性与美观度。在功能配置上，该浴缸集成了多项高端智能功能：支持手机APP远程预约加热，可精准控制水温在35℃-42℃之间，误差不超过±0.5℃；配备12组独立按摩区域，涵盖头部、颈部、背部、腰部、腿部等关键部位，每组区域的按摩力度可独立调节（1-15档）；搭载智能水质监测系统，实时监测水中余氯、PH值等参数，当数值超标时自动启动过滤与净化程序；还具备音乐播放功能，缸体两侧内置隐形音响，连接蓝牙即可播放音乐，音质清晰无杂音。在浴缸的配件定制方面，设计师与厂家深度合作，每个配件都经过精心选型：龙头采用纯手工锻造的铜质龙头，表面经过拉丝处理，搭配天然玉石阀芯，出水柔和且节水效果显著，最大出水流量为10L/min；下水器采用重力式设计，内置防臭装置与毛发过滤系统，排水速度达20L/min，同时具备静音功能，排水噪音低于25dB；智能控制面板嵌入在浴缸侧边的实木边框内，采用触控式操作，配备高清液晶显示屏，可实时显示水温、按摩模式、水质参数等信息。而作为按摩功能核心的喷嘴，其规格参数更是经过反复调试确定：设计师根据业主对按摩力度与覆盖范围的要求，选择了厂商定制的高精密喷嘴，该喷嘴采用医用级硅胶材质，柔软亲肤，不易结垢，且具备防堵塞自清洁功能。方案说明书中明确标注：为实现最佳的按摩体验，本定制款浴缸的喷嘴采用专属规格编号，浴缸喷嘴是25，该编号由厂商根据业主的身高、体重以及按摩偏好专项设定，对应的喷嘴口径为2.0mm，喷射角度为35°，水流速度可达到3.0m/s，能够精准作用于肌肉酸痛部位，起到舒缓疲劳的效果。此外，说明书还详细列出了其他无关细节，包括：二层次卫配备普通按摩浴缸，喷嘴编号为18；地下室休闲卫浴区采用冲浪浴缸，无固定喷嘴编号；户外温泉区配备天然石材浴缸，仅具备基础加热功能；全卫浴区域的灯光系统采用智能调光设计，支持色温调节（2700K-6500K）与场景模式切换（洗漱、沐浴、放松）；通风系统采用双向流新风换气机，每小时换气次数≥8次，确保空气清新；所有卫浴产品均通过欧盟CE认证与国内CQC认证，环保等级达到E0级，甲醛释放量≤0.124mg/m³；整体卫浴区域的设计预算为38万元，其中定制浴缸的采购与安装费用占比达40%。请你忽略所有与一层主卫定制款浴缸喷嘴无关的描述，从这份超长的设计方案说明书中，精准提取出对应的核心数值编号。"
            ]
        ]
    }
}

question = sample["question"]
context = " ".join([" ".join(s) for s in sample["context"]["sentences"]])
# 如果只想让评估关注“25”是否正确，可以用 ground_truth = "25"
ground_truth = "25"

# 第一次：用当前 playbook 推理
result_before = ace.adapt_online(
    question=question,
    context=context,
    ground_truth=ground_truth,
)

print("===== Result BEFORE adaptation on this sample =====")
print(result_before)

# 再保存一下最新的 playbook / metrics（可选，但推荐）
ace.save_results(output_dir="./interactive_results")

# 第二次：用更新后的 playbook 再推一遍同一个样本
result_after = ace.adapt_online(
    question=question,
    context=context,
    ground_truth=ground_truth,
)

print("\n===== Result AFTER adaptation on this sample =====")
print(result_after)